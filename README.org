#+title: README

* Bootstrapping Process
** Obtain a bootable NixOS iso image from https://nixos.org/download.html#nixos-iso.
The ~Minimal ISO image~ does the job and is smaller, thus takes less to download. But anyone will do.
** Write it verbatim to a usb thumbdrive
** Boot your system with it
** Wipe the drive clean
#+begin_src shell
blkdiscard -f /dev/nvme0n1
#+end_src
** Clone this flake
#+begin_src shell
rm -rf /etc/nixos
git clone https://github.com/panchoh/nixos.git /etc/nixos
#+end_src
** Manage filesystems with Disko
#+begin_src shell
cd /etc/nixos
bin/activate-disko
#+end_src
** Bootstrap NixOS
CAVEAT EMPTOR: it takes a few minutes.
#+begin_src shell
nixos-install --flake /etc/nixos#helium
#+end_src
** Reboot
#+begin_src shell
reboot
#+end_src
** Login and change the password
#+begin_src shell
passwd
#+end_src
** Finish setting up (Home Manager)
#+begin_src shell
sudo nixos-rebuild switch
#+end_src
** Reboot
#+begin_src shell
reboot
#+end_src
** Enjoy!

* TODO
* Documentation
** https://thiscute.world/en/posts/nixos-and-flake-basics/
** https://discourse.nixos.org/t/tips-tricks-for-nixos-desktop/28488
** https://nixos.org/manual/nixpkgs/
** https://ryantm.github.io/nixpkgs/
** https://ryantm.github.io/nixpkgs/functions/library/attrsets/
* Adhere to https://gist.github.com/joshbuchea/6f47e86d2510bce28f8e7f42ae84c716
* dotfiles to explore
- [ ] https://github.com/Shawn8901/nix-configuration
- [ ] https://github.com/privatevoid-net/depot/blob/master/hosts/nixos.nix
- [ ] https://github.com/meppu/nix-config
- [ ] https://github.com/matklad/config/blob/master/hosts/default.nix
- [ ] https://github.com/mitchellh/nixos-config
- [ ] https://github.com/Kranzes/nix-config
- [ ] https://github.com/ryantm/dotfiles
- [ ] https://github.com/znewman01/dotfiles
- [ ] https://github.com/srid/nixos-config/blob/master/flake.nix
- [ ] https://git.sr.ht/~bwolf/dotfiles/tree/master/item/flake.nix
- [ ] https://github.com/terlar/emacs-config/blob/main/flake.nix
- [ ] https://github.com/bbigras/nix-config/
- [ ] https://git.hrnz.li/Ulli/nixos/src/branch/main/profiles/pipewire/mic.nix
- [ ] https://github.com/bqv/rc
- [ ] https://git.sr.ht/~glorifiedgluer/monorepo
- [ ] https://github.com/tejing1/nixos-config/
- [ ] https://github.com/MatthewCroughan/nixcfg/blob/master/modules/profiles/sway.nix
- [ ] https://github.com/hlissner/dotfiles/blob/master/flake.nix
- [ ] xe's https://github.com/Xe/nixos-configs
- [ ] https://github.com/hyprwm/Hyprland/pull/870#issuecomment-1319448768
- [ ] https://github.com/fufexan/dotfiles/blob/main/home/wayland/hyprland/config.nix
- [ ] hyprland https://github.com/davmedeiros/dotfiles/blob/main/hyprland/.config/hypr/hyprland.conf
- [ ] https://github.com/fufexan/dotfiles/blob/main/home/wayland/hyprland/config.nix#enroll-beta
- [ ] https://github.com/fufexan/dotfiles/blob/main/flake.nix
- [ ] https://guekka.github.io/nixos-server-1/
- [ ] https://codeberg.org/imMaturana/dotfiles/src/branch/main/flake.nix
- [ ] https://github.com/dwarfmaster/home-nix/blob/master/flake.nix
- [ ] https://github.com/Kranex/nixos-config/blob/master/flake.nix

* https://nixos.wiki/wiki/Comparison_of_NixOS_setups
* https://nixos.wiki/wiki/Configuration_Collection

* foot
** https://codeberg.org/dnkl/foot/issues/628#issuecomment-283074

* swap
https://discourse.nixos.org/t/how-do-i-set-up-a-swap-file/8323

* emacs
https://codeberg.org/nosewings/emacs-init/src/branch/main/flake.nixfs
https://github.com/danth/stylix/pull/77 emacs 29+ alpha-background
https://nixos.org/manual/nixos/stable/#sec-customising-packages
** (emacs.override { withPgtk = true; };
** configuration.nix
#+begin_src nix
{...}: let
  emacsWithPgtk = pkgs.emacs.override {withPgtk = true;};
  emacsWithPackages = (pkgs.emacsPackagesFor emacsWithPgtk).emacsWithPackages;
  customEmacs = emacsWithPackages (epkgs: with epkgs.melpaPackages; [magit pdf-tools vterm dracula-theme]);
in {
  ...
    packages = with pkgs; [
    customEmacs
    emacs-all-the-icons-fonts
  ]
#+end_src

** Notable dotfiles
- https://github.com/jwiegley/dot-emacs/blob/master/init.org
- https://github.com/robbert-vdh/dotfiles/blob/master/user/emacs/.config/doom/config.org

** configuration.nix
#+begin_src nix
# TOTEST
# https://discourse.nixos.org/t/advice-needed-installing-doom-emacs/8806/8

nixpkgs.config.packageOverrides = pkgs: {
  emacs = pkgs.emacs.override { withPgtk = true; };
};
#+end_src

** Iosevka
https://stackoverflow.com/questions/62230166/configuring-iosevka-for-nix

** Using community's emacs overlay
https://github.com/bbigras/nix-config/
https://github.com/terlar/emacs-config/blob/main/flake.nix
https://git.sr.ht/~bwolf/dotfiles/tree/master/item/flake.nix
https://www.reddit.com/r/NixOS/comments/uzcfjz/trouble_with_emacs_overlay
https://discourse.nixos.org/t/how-to-apply-an-overlay-defined-in-one-flake-in-my-flake/11987

* stylix
** https://github.com/danth/stylix/pull/23 dualiy hm nixos

* https://github.com/nix-community/nixos-generators

* nix registry
** https://nixos.org/manual/nix/unstable/command-ref/new-cli/nix3-registry.html
** https://discourse.nixos.org/t/how-to-pin-nix-registry-nixpkgs-to-release-channel/14883/6
** https://discourse.nixos.org/t/using-flakes-in-home-manager-module-especially-for-unfree-packages/21476
** https://discourse.nixos.org/t/local-flake-based-nix-search-nix-run-and-nix-shell/13433/13
** https://github.com/tejing1/nixos-config/blob/11424383bed8eff2d5399f638cc5d1ef732425dc/nixosConfigurations/tejingdesk/registry.nix#L27-L29
# the version of this flake used to build the system
  nix.registry.activeconfig.flake = self;
  environment.etc."nix/path/activeconfig".source = self;

* EasyEffects
** https://nix-community.github.io/home-manager/options.html#opt-services.easyeffects.enable
** https://en.wikipedia.org/wiki/EasyEffects
** https://www.reddit.com/r/NixOS/comments/10c3s93/homemanager_nixos_module_or_best_practice_for/


* Doom
** Tip by nilp0inter on how to ensure that the doom init script has git available
*** https://github.com/NixOS/nixpkgs/blob/d450afc911598812d54cbac7e384a2bf4724f9ce/pkgs/development/compilers/rust/cargo-auditable-cargo-wrapper.nix
*** https://raw.githubusercontent.com/NixOS/nixpkgs/d450afc911598812d54cbac7e384a2bf4724f9ce/pkgs/top-level/all-packages.nix
**** callPackage
** https://www.damiengonot.com/notes/computer-science/tools/text-editors/emacs/doom-emacs
** https://github.com/emacs-openai/chatgpt y dall-e
** https://github.com/nix-community/nix-doom-emacs/issues/297

** Seen on AUR/emacs29-git
emacs29-git/site-list-aot.md
@@ -0,0 +1,20 @@
+# ON-DEMAND COMPILATION OF SITE-LISP AND LOCAL PACKAGES
+
+To compile all site-lisp on demand (repos/AUR packages, ELPA, MELPA,
+ whatever), add
+
+    (setq native-comp-deferred-compilation t)
+
+to your `.emacs` file.
+
+Or search the option in the editor's GUI configuration, set it
+to true and save your `.emacs` file to add it to the file's
+`custom-set-variables` array automatically.
+
+As emacs-git changes its version everytime you compile a new
+binary, new eln files are generated for that particular binary
+and old versions will accumulate over time. To keep the eln-cache
+tidy, add this to your `.emacs` file:
+
+    (setq native-compile-prune-cache t)
+

** Study https://github.com/nix-community/nix-doom-emacs/blob/master/default.nix

* NUR
https://nur.nix-community.org/repos/rycee/

* https://github.com/nix-community/comma

* Overlays with flake-parts
https://discourse.nixos.org/t/how-to-use-overlays-in-a-flake-with-flake-parts/24308/4

* hyprland on nVidia
https://www.reddit.com/r/NixOS/comments/137j18j/need_guide_on_installing_hyprland/

* direnv
https://github.com/znewman01/dotfiles/blob/master/.envrc
* OCR to clipboard
https://www.reddit.com/r/NixOS/comments/13uboa6/text_from_image_to_clipboard_nix_tip/ (check for one-liner by balsoft)
#+begin_src nix
...
grim -g "$(slurp)" - | tesseract - - | wl-copy -
...
#+end_src
